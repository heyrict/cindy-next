- args:
    cascade: false
    sql: |-
      CREATE OR REPLACE FUNCTION maybe_delete_tag_after_puzzle_tag_delete()
      RETURNS TRIGGER as $$
      DECLARE
        puzzle_tag_count INTEGER;
      BEGIN
        SELECT count(id) FROM puzzle_tag WHERE tag_id = OLD.tag_id INTO puzzle_tag_count;
        IF puzzle_tag_count = 0 THEN
          DELETE from tag WHERE id = OLD.tag_id;
        END IF;
        RETURN OLD;
      END;
      $$ LANGUAGE 'plpgsql';

      CREATE TRIGGER maybe_delete_tag_after_puzzle_tag_delete_trigger AFTER DELETE
      ON public.puzzle_tag
      FOR EACH ROW
      EXECUTE PROCEDURE maybe_delete_tag_after_puzzle_tag_delete();
  type: run_sql
